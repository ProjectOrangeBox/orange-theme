/*
<form action="/post.php" method="post"...

data-confirm="heading|body|icon|cancel|ok"
data-primary_id="id" - default id
data-success="Text|style|(bool)stay" - stay defaults to false 
data-redirect="/url" - redirect to this url on success
data-fadeout="tr" - closest element to fade out on success

...>

*/
/* create our empty classes */
var orange=orange||{};orange.dialog=orange.dialog||{},
/* handler for the submit button click */
orange.dialog.button_submit_click=function(o,r){
/* is a confirm data attribute on the form element? */
if(
/* prevent the default action */
o.preventDefault(),
/*save a copy of "this" */
orange.that=$(r),
/* travel up from the submit button and find the closest <form> */
orange.form_obj=orange.that.closest("form"),orange.form_obj.data("confirm")){
/* these are a pipe separated list  (seemed the easiest - note the order) */
var e=1!=orange.form_obj.data("confirm")?orange.form_obj.data("confirm").split("|"):"",a=e[0]?e[0]:"Are you sure?",n=e[1]?e[1]:"",t=e[2]?e[2]:"exclamation-triangle",g=e[3]?e[3]:"Cancel",i=e[4]?e[4]:"Ok";
/* show the dialog */
orange.dialog.show(t,a,n,g,i)}else
/* no dialog to show so just call the "continue" callback */
orange.dialog.confirm_ok(o,r)}
/* when Form Ajax Fails Hard */,orange.dialog.request_fail=function(){
/* pop up a fail message */
orange.flash_msg("Action Failed","red",!1)},orange.get_length=function(o,r){if(r)return o.hasOwnProperty(r)?0<o[r].length:0;
/* all */var e=0;for(var a in o)o.hasOwnProperty(a)&&(e+=o[a].length);return e},orange.get_errors=function(o,r,e){
/* only */
if(e)return o.hasOwnProperty(e)&&0<o[e].length?o[e].join(r):"";
/* all */var a=[];for(var n in o)o.hasOwnProperty(n)&&0<o[n].length&&a.push(o[n].join(r));return a.join(r)}
/*when Form Ajax Success - but could have errors */,orange.dialog.request_done=function(o){var r;
/* show any errors */if(
/* hide all of the notices */
$.noticeRemoveAll(),0<orange.get_length(o.ci_errors,orange.form.errors_for))$.noticeAdd({text:orange.get_errors(o.ci_errors,"<br>",orange.form.errors_for),type:"danger",stay:!0});else{
/* no errors so continue with work */
/* is fadeout set for this action highlight it "info" color for a split second until it get's lower in the code */
orange.that.closest(orange.form_obj.data("fadeout"))&&orange.that.closest(orange.form_obj.data("fadeout")).addClass("info")
/*
		don't forget to merge the primary key hidden on the details form with the returned value from a insert
		get the primary key from the stored value on the form or default to id
		*/;var e=orange.form_obj.data("primary_id")?orange.form_obj.data("primary_id"):"id",a;
/* did the responds have a primary key value? if so put that as the value */
/* data-success="message|style" */
if(o.primary_key&&$("input[name="+e+"]").val(o.primary_key),orange.form_obj.data("success")){var n=orange.form_obj.data("success").split("|"),a=!!orange.form_obj.data("redirect")||"false"!==n[2]&&orange.form_obj.attr("action");
/* does redirect contain something? if it does than save msg in browser local storage */orange.flash_msg(n[0],n[1],a),
/* switch post (insert) to patch (update) now */
"post"==orange.form_obj.attr("method").toLowerCase()&&orange.form_obj.attr("method","PATCH")}
/* now fade it out */
/* redirect if a redirect exists */
if(orange.that.closest(orange.form_obj.data("fadeout"))&&orange.that.closest(orange.form_obj.data("fadeout")).fadeOut(),orange.form_obj.data("redirect"))"action"==(a=orange.form_obj.data("redirect"))&&(a=orange.form_obj.attr("action")),orange.redirect(a)}}
/* dialog confirm button or form submit */,orange.dialog.confirm_ok=function(){console.log(orange.form_obj.attr("action")),orange.dialog.request=$.ajax({method:orange.form_obj.attr("method"),url:orange.form_obj.attr("action"),data:orange.form_obj.serializeArray(),dataType:"json",cache:!1,timeout:5e3,async:!0}),orange.dialog.request.fail(function(){
/* defined above and can be overridden */
orange.dialog.request_fail()}),orange.dialog.request.done(function(o){void 0===o?
/* beats me what happened? Show a flash msg. */
orange.flash_msg("Unknown Reply","yellow",!1):
/* it's all good call the function */
/* defined above and can be overridden */
orange.dialog.request_done(o)})}
/* main form submit button */,$(".js-button-submit").on("click",function(o){orange.dialog.button_submit_click(o,this)}),
/* generic form submit */
orange.form={},
/* set this to only show errors from 1 error group */
orange.form.errors_for||(orange.form.errors_for=!1),orange.form.success=function(o){var r=!0,e;
/* hide all of the notices */return $.noticeRemoveAll(),
/* show any errors */
0<orange.get_length(o.ci_errors,orange.form.errors_for)&&($.noticeAdd({text:orange.get_errors(o.ci_errors,"<br>",orange.form.errors_for),type:"danger",stay:!0}),r=!1),r},orange.form.request_done=function(o,r){},/* place holder for user to extend as needed */
orange.form.submit=function(o,r,e){orange.form.request=$.ajax({method:o,url:r,data:e,dataType:"json",cache:!1,timeout:5e3,async:!0}),orange.form.request.fail(function(){
/* defined above and can be overridden */
orange.dialog.request_fail()}),orange.form.request.done(function(o){if(void 0===o)
/* beats me what happened? Show a flash msg. */
orange.flash_msg("Unknown Reply","yellow",!1);else{var r=orange.form.success(o);orange.form.request_done(o,r)}})}/* end orange.form.submit */;
//# sourceMappingURL=rest-form.min.js.map