var fuploader={};fuploader.client=new XMLHttpRequest,$(function(){$(".js-fuploader").on("change",function(){fuploader.upload(this)}),$(".js-fupload-remove").on("click",function(){fuploader.clear(this)})}),fuploader.clear=function(e){var a=$(e).data("id");$("#"+a+"-msg").html(""),$("#"+a+"-hidden").val(""),$("#"+a+"-new").val(""),$("#"+a+"-preview").prop("src","")},fuploader.upload=function(e){fuploader.id=$(e).prop("id");var a=$("#"+fuploader.id).data("url"),r=document.getElementById(fuploader.id);$("#"+fuploader.id+"-preview").length&&fuploader.readURL(e),pleaseWaitDiv.modal("show");var t=new FormData;t.append("url",a),t.append(fuploader.id,r.files[0]);var d=fuploader.objectifyForm($(e).closest("form").serializeArray());for(var l in d)d.hasOwnProperty(l)&&t.append(l,d[l]);fuploader.client.open("post",a,!0),fuploader.client.send(t)},fuploader.objectifyForm=function(e){for(var a={},r=0;r<e.length;r++)a[e[r].name]=e[r].value;return a},fuploader.client.onreadystatechange=function(){if(4==fuploader.client.readyState&&200==fuploader.client.status){pleaseWaitDiv.modal("hide"),$.noticeRemoveAll();var e=JSON.parse(fuploader.client.response);if(0==e.error){$("#"+e.fieldname+"-msg").html(e.filename),$("#"+e.fieldname+"-new").length?$("#"+e.fieldname+"-new").val(e.attached_id):$("#"+e.fieldname).after('<input type="hidden" name="'+e.fieldname+'-new" id="" value="'+e.attached_id+'">');var a=e.msg?e.msg:"Attached";$.noticeAdd({text:a,type:"info"})}else{$("#"+fuploader.id+"-preview").attr("src",""),$("#"+e.fieldname+"-msg").html("");var a=e.msg?e.msg:"Attach Error";$.noticeAdd({text:a,type:"danger",stay:!0,stayTime:0})}}},fuploader.readURL=function(e){if(e.files&&e.files[0]){var a=new FileReader;a.onload=function(e){$("#"+fuploader.id+"-preview").attr("src",e.target.result)},a.readAsDataURL(e.files[0])}};