/*
<form action="/post.php" method="post"...

data-confirm="heading|body|icon|cancel|ok"
data-primary_id="id" - default id
data-success="Text|style|(bool)stay" - stay defaults to false 
data-redirect="/url" - redirect to this url on success
data-fadeout="tr" - closest element to fade out on success

...>

*/
/* create our empty classes */
var orange=orange||{};orange.dialog=orange.dialog||{},
/* handler for the submit button click */
orange.dialog.button_submit_click=function(o,r){
/* is a confirm data attribute on the form element? */
if(
/* prevent the default action */
o.preventDefault(),
/*save a copy of "this" */
orange.that=$(r),
/* travel up from the submit button and find the closest <form> */
orange.form_obj=orange.that.closest("form"),orange.form_obj.data("confirm")){
/* these are a pipe separated list  (seemed the easiest - note the order) */
var e=1!=orange.form_obj.data("confirm")?orange.form_obj.data("confirm").split("|"):"",a=e[0]?e[0]:"Are you sure?",t=e[1]?e[1]:"",n=e[2]?e[2]:"exclamation-triangle",i=e[3]?e[3]:"Cancel",g=e[4]?e[4]:"Ok";
/* show the dialog */
orange.dialog.show(n,a,t,i,g)}else
/* no dialog to show so just call the "continue" callback */
orange.dialog.confirm_ok(o,r)}
/* when Form Ajax Fails Hard */,orange.dialog.request_fail=function(){
/* pop up a fail message */
orange.flash_msg("Action Failed","red",!1)}
/*when Form Ajax Success - but could have errors */,orange.dialog.request_done=function(o){
/* show any errors */
if(
/* hide all of the notices */
$.noticeRemoveAll(),0<o.ci_errors.count){for(var r="",e=0,a=o.ci_errors.records.length;e<a;e++)r+=o.ci_errors.records[e]+"<br>";$.noticeAdd({text:r,type:"danger",stay:!0})}else{
/* no errors so continue with work */
/* is fadeout set for this action highlight it "info" color for a split second until it get's lower in the code */
orange.that.closest(orange.form_obj.data("fadeout"))&&orange.that.closest(orange.form_obj.data("fadeout")).addClass("info")
/*
		don't forget to merge the primary key hidden on the details form with the returned value from a insert
		get the primary key from the stored value on the form or default to id
		*/;var t=orange.form_obj.data("primary_id")?orange.form_obj.data("primary_id"):"id",n;
/* did the responds have a primary key value? if so put that as the value */
/* data-success="message|style" */
if(o.primary_key&&$("input[name="+t+"]").val(o.primary_key),orange.form_obj.data("success")){var i=orange.form_obj.data("success").split("|"),n=!!orange.form_obj.data("redirect")||"false"!==i[2]&&orange.form_obj.attr("action");
/* does redirect contain something? if it does than save msg in browser local storage */orange.flash_msg(i[0],i[1],n),
/* switch post (insert) to patch (update) now */
"post"==orange.form_obj.attr("method").toLowerCase()&&orange.form_obj.attr("method","PATCH")}
/* now fade it out */
/* redirect if a redirect exists */
if(orange.that.closest(orange.form_obj.data("fadeout"))&&orange.that.closest(orange.form_obj.data("fadeout")).fadeOut(),orange.form_obj.data("redirect"))"action"==(n=orange.form_obj.data("redirect"))&&(n=orange.form_obj.attr("action")),orange.redirect(n)}}
/* dialog confirm button or form submit */,orange.dialog.confirm_ok=function(){console.log(orange.form_obj.attr("action")),orange.dialog.request=$.ajax({method:orange.form_obj.attr("method"),url:orange.form_obj.attr("action"),data:orange.form_obj.serializeArray(),dataType:"json",cache:!1,timeout:5e3,async:!0}),orange.dialog.request.fail(function(){
/* defined above and can be overridden */
orange.dialog.request_fail()}),orange.dialog.request.done(function(o){void 0===o?
/* beats me what happened? Show a flash msg. */
orange.flash_msg("Unknown Reply","yellow",!1):
/* it's all good call the function */
/* defined above and can be overridden */
orange.dialog.request_done(o)})}
/* main form submit button */,$(".js-button-submit").on("click",function(o){orange.dialog.button_submit_click(o,this)}),
/* generic form submit */
orange.form={},orange.form.success=function(o){var r=!0;
/* hide all of the notices */
/* show any errors */
if($.noticeRemoveAll(),0<o.ci_errors.count){for(var e="",a=0,t=o.ci_errors.records.length;a<t;a++)e+=o.ci_errors.records[a]+"<br>";$.noticeAdd({text:e,type:"danger",stay:!0}),r=!1}return r}/* end orange.form.success */,orange.form.request_done=function(o,r){},/* place holder for user to extend as needed */
orange.form.submit=function(o,r,e){orange.form.request=$.ajax({method:o,url:r,data:e,dataType:"json",cache:!1,timeout:5e3,async:!0}),orange.form.request.fail(function(){
/* defined above and can be overridden */
orange.dialog.request_fail()}),orange.form.request.done(function(o){void 0===o?
/* beats me what happened? Show a flash msg. */
orange.flash_msg("Unknown Reply","yellow",!1):orange.form.request_done(o,orange.form.success(o))})}/* end orange.form.submit */;
//# sourceMappingURL=rest-form.min.js.map