var fuploader={};fuploader.client=new XMLHttpRequest;$(function(){$(".js-fuploader").each(function($index$$){$(this).before('<span id="msg-'+$(this).prop("id")+'"></span>')});$(".js-fuploader").on("change",function(){fuploader.upload(this)})});
fuploader.upload=function $fuploader$upload$($that_url$$){$("#image-preview").length&&fuploader.readURL($that_url$$);var $form_obj_id$$=$($that_url$$).prop("id");$that_url$$=$("#"+$form_obj_id$$).data("url");var $file$$=document.getElementById($form_obj_id$$);pleaseWaitDiv.modal("show");var $formData$$=new FormData;$formData$$.append($form_obj_id$$,$file$$.files[0]);$formData$$.append("url",$that_url$$);var $form_obj_id$$=$("#main-form").mvcForm2Obj(),$prop$$;for($prop$$ in $form_obj_id$$)$formData$$.append($prop$$,
$form_obj_id$$[$prop$$]);fuploader.client.open("post",$that_url$$,!0);fuploader.client.send($formData$$)};
fuploader.client.onreadystatechange=function $fuploader$client$onreadystatechange$(){if(4==fuploader.client.readyState&&200==fuploader.client.status){pleaseWaitDiv.modal("hide");$.noticeRemoveAll();var $response$$=jQuery.parseJSON(fuploader.client.response);0==$response$$.error?($("#msg-"+$response$$.fieldname).html($response$$.extra+$response$$.filename+'&nbsp;<input type="hidden" name="'+$response$$.fieldname+'" value="'+$response$$.attached_id+'">'),plugins.flash_msg.show("green",$response$$.msg)):
($("#image-preview").attr("src",""),$("#msg-fileupload").html(""),plugins.flash_msg.show("red",$response$$.msg))}};fuploader.readURL=function $fuploader$readURL$($input$$){if($input$$.files&&$input$$.files[0]){var $reader$$=new FileReader;$reader$$.onload=function $$reader$$$onload$($e$$){$("#image-preview").attr("src",$e$$.target.result)};$reader$$.readAsDataURL($input$$.files[0])}};
